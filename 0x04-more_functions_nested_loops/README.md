This is C, more functions, more nested loops
